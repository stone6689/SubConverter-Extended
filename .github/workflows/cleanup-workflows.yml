name: Cleanup Failed Workflows

on:
  workflow_dispatch:

permissions:
  actions: write
  contents: read

jobs:
  cleanup:
    runs-on: ubuntu-latest
    
    steps:
      - name: Delete Failed, Cancelled and Skipped Workflow Runs
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          echo "üßπ Cleaning up failed, cancelled and skipped workflow runs..."
          
          # Get all workflow runs and delete them
          gh api repos/${{ github.repository }}/actions/runs \
            --paginate \
            -q '.workflow_runs[] | select(.conclusion=="failure" or .conclusion=="cancelled" or .conclusion=="skipped") | .id' \
            | while read run_id; do
              echo "üóëÔ∏è  Deleting run ID: $run_id"
              gh api repos/${{ github.repository }}/actions/runs/$run_id -X DELETE || echo "   ‚ö†Ô∏è  Failed to delete $run_id"
            done
          
          echo ""
          echo "‚úÖ Cleanup completed!"
